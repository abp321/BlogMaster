@page "/editpost"
@page "/editpost/{Id:int}"
@rendermode InteractiveWebAssembly
@using BlogMaster.Shared.Interfaces

@inject IBlogService blogService
@inject NavigationManager navigationManager

<BlogPostEditor @rendermode=InteractiveWebAssembly
    BlogPost="blogPost"
    OnSave="HandleSave"
    OnCancel="HandleCancel" />

@code {
    [Parameter]
    public int? Id { get; set; }

    private BlogDto blogPost = new();

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue)
        {
            var existingPost = await blogService.GetBlog(Id.Value);
            if (existingPost is null)
            {
                navigationManager.NavigateTo("/blogs");
                return;
            }
            blogPost = existingPost;
        }
        await base.OnInitializedAsync();
    }

    async Task HandleSave(BlogDto updatedBlog)
    {
        await blogService.CreateBlog(updatedBlog);
        navigationManager.NavigateTo("/blogs");
    }

    void HandleCancel()
    {
        navigationManager.NavigateTo("/blogs");
    }
}
